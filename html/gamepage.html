<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="game-title">Название игры</title>
    <link rel="stylesheet" href="../css/gamepage.css">
    <script src="../js/services/users.js"></script>
    <script src="../js/services/games.js"></script> <!-- Добавьте ваш файл с функциями для работы с играми -->
</head>

<body>
    <header>
        <div class="logo">Heat</div>
        <nav>
            <ul>
                <li><a href="store.html" class="active">Магазин</a></li>
                <li><a href="about.html">О нас</a></li>
                <li><a id="auth-link" href="login.html">Вход</a></li>
            </ul>
        </nav>
    </header>

    <main>
        <h1 class="game-title" id="game-title-display">Название игры</h1>

        <div class="game-container">
            <div class="media-carousel">
                <div class="selected-media">
                    <video id="selected-video" controls>
                        <source src="" type="video/mp4">
                    </video>
                </div>
                <div class="carousel">
                    <!-- Здесь будут медиа элементы -->
                </div>
            </div>

            <div class="game-details">
                <p class="game-description" id="game-description"></p>
                <p class="game-info" id="game-info"></p>
                <button class="add-to-cart">Добавить в корзину</button>
            </div>
        </div>

        <div class="review-section">
            <h2>Оцените игру</h2>
            <div class="review-stars">
                <span class="star" data-value="1">&#9733;</span>
                <span class="star" data-value="2">&#9733;</span>
                <span class="star" data-value="3">&#9733;</span>
                <span class="star" data-value="4">&#9733;</span>
                <span class="star" data-value="5">&#9733;</span>
            </div>
            <button class="submit-review" disabled>Оставить отзыв</button>
        </div>
    </main>

    <footer>
        <p>&copy; 2024 Heat. Все права защищены.</p>
    </footer>

    <script type="module">
        userIsAuth();

        // Функция для получения параметра из URL
        function getParameterByName(name, url = window.location.href) {
            name = name.replace(/[\[\]]/g, "\\$&");
            const regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
                results = regex.exec(url);
            if (!results) return null;
            if (!results[2]) return '';
            return decodeURIComponent(results[2].replace(/\+/g, " "));
        }

        const gameTitle = getParameterByName('title');

        // Функция для загрузки данных о игре
        async function loadGameData(title) {
            try {
                const games = await getGames(); // Предполагается, что эта функция возвращает массив игр
                const game = games.find(g => g.title === title);
                
                if (game) {
                    document.getElementById('game-title').innerText = game.title;
                    document.getElementById('game-title-display').innerText = game.title;
                    document.getElementById('game-description').innerText = game.description;
                    document.getElementById('game-info').innerHTML = `
                        <strong>Разработчик:</strong> ${game.developer} <br>
                        <strong>Дата релиза:</strong> ${new Date(game.releaseDate).toLocaleDateString()} <br>
                        <strong>Цена:</strong> ${game.price} руб.<br>
                    `;

                    // Загрузка медиа
                    const mediaCarousel = document.querySelector('.carousel');
                    const selectedMedia = document.querySelector('.selected-media');

                    // Загружаем трейлер
                    selectedMedia.innerHTML = `<video id="selected-video" controls>
                        <source src="${game.trailer}" type="video/mp4">
                    </video>`;
                    
                    // Загружаем изображения
                    game.images.forEach(image => {
                        mediaCarousel.innerHTML += `<img src="../static/games/${game.title}/${image}" alt="${image}" class="carousel-item" onclick="selectMedia('${image}')">`;
                    });
                } else {
                    alert('Игра не найдена.');
                }
            } catch (error) {
                console.error('Ошибка загрузки данных о игре:', error);
                alert('Не удалось загрузить данные о игре.');
            }
        }

        // Вызов функции загрузки данных о игре
        loadGameData(gameTitle);
        
        // Остальной код для выбора медиа и отзывов...
        function selectMedia(src) {
            const selectedMedia = document.querySelector('.selected-media');
            if (src.endsWith('.mp4')) {
                selectedMedia.innerHTML = `<video controls>
                    <source src="${src}" type="video/mp4">
                </video>`;
            } else {
                selectedMedia.innerHTML = `<img src="${src}" alt="Selected media">`;
            }
        }
    </script>
</body>

</html>
